import sqlite3

import unicodedata
from datetime import datetime
import nltk
from inflector import Inflector

dbtext = sqlite3.connect("file:text.db", uri=True)
dbtext.row_factory = sqlite3.Row
//英語は格納テーブルを変える

dbword = sqlite3.connect("file:words.db", uri=True)
dbword.row_factory = sqlite3.Row

lasttime = ""
row = dbword.execute("select time from wordstbl order by time desc limit 1").fetchone()
if row is not None:
	lasttime = row["time"]

count = 0
fromtime = ""
totime = ""

for row in dbtext.execute("select * from rawtext where time > ? order by time", (lasttime,)):
	node = tagger.parseToNode(unicodedata.normalize("NFKC", row["rawtext"]))
    separated_text = ""
	while node:
		tokens = nltk.word_tokenize(sentence)
        tagged = nltk.pos_tag(tokens)
		if tagged[row][1] in ["NNP","NNS","NN"]:
			separated_text = separated_text + " " + tageed[row][0]
		node = node.next
	
	insert = "INSERT INTO wordstbl(id, source, time, words) VALUES(?, ?, ?, ?)"
	args = (row["id"], row["source"], row["time"], separated_text)

	if fromtime > row["time"] or fromtime == "":
		fromtime = row["time"]
	if totime < row["time"]:
		totime = row["time"]

	try:
		dbword.execute(insert, args)
		count = count + 1
	except sqlite3.Error as e:
		print ('sqlite3:', e.args[0])

dbword.commit()
dbword.close()
dbtext.close()

print (datetime.now().isoformat()+":words.db written(" + str(count) + ")(" + fromtime + "~" + totime + ")")

